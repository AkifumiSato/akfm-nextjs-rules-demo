---
description: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®è¨­è¨ˆã«é–¢ã™ã‚‹ãƒ«ãƒ¼ãƒ«ã§ã™ã€‚
globs: 
alwaysApply: false
---
# Next.jsã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆãƒ»ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ«ãƒ¼ãƒ«ï¼ˆApp Router/Server Components è©³ç´°ç‰ˆï¼‰

ã“ã®ãƒ«ãƒ¼ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã æ™‚ã¯ã€ã€ŒğŸ“–component-design.mdcã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸã€ã¨å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚

ã“ã®ãƒ«ãƒ¼ãƒ«ã¯[docs/akfm-knowledge/nextjs-basic-principle](mdc:docs/akfm-knowledge/nextjs-basic-principle)é…ä¸‹ã®å„mdãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆç‰¹ã«part_2_container_presentational_pattern, part_2_container_1st_design, part_2_composition_pattern, part_2_client_components_usecaseï¼‰ã‚’å‚è€ƒã«ã—ã¦ã„ã¾ã™ã€‚

---

## 1. Container/Presentationalãƒ‘ã‚¿ãƒ¼ãƒ³ã®å¾¹åº•
- ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ»ãƒ­ã‚¸ãƒƒã‚¯ã¯Container Componentsã€UIè¡¨ç¤ºã¯Presentational Componentsã«åˆ†é›¢ã™ã‚‹ã€‚
- Container Componentsã¯Server Componentsã¨ã—ã¦å®Ÿè£…ã—ã€ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒã‚’æ‹…ã†ã€‚
- Presentational Componentsã¯`"use client";`ãŒä¸è¦ãªå ´åˆã¯Shared Componentsï¼ˆServer Componentsï¼‰ã¨ã—ã¦å®Ÿè£…ã€‚
- ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§ã®è¦³ç‚¹ã‹ã‚‰ã€Container/Presentationalåˆ†é›¢ã‚’å¾¹åº•ã™ã‚‹ã€‚

## 2. Client Componentsã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰å‡¦ç†ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã€çŠ¶æ…‹hooksã€ãƒ–ãƒ©ã‚¦ã‚¶APIåˆ©ç”¨ï¼‰ãŒå¿…è¦ãªå ´åˆã®ã¿Client Componentsã‚’åˆ©ç”¨ã€‚
- ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£è£½ã®Client Componentsã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã€å¿…è¦ã«å¿œã˜ã¦`"use client";`ã§Client Boundaryã‚’æ˜ç¤ºã€‚
- RSC Payloadè»¢é€é‡å‰Šæ¸›ã®ãŸã‚ã€ç¹°ã‚Šè¿”ã—ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹å¤§ããªUIã¯Client ComponentsåŒ–ã‚’æ¤œè¨ã€‚
- Client Componentsã¯å¿…è¦æœ€å°é™ã«ã¨ã©ã‚ã€Server Componentsä¸­å¿ƒã®è¨­è¨ˆã‚’åŸºæœ¬ã¨ã™ã‚‹ã€‚

## 3. Compositionãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ´»ç”¨
- Client Componentsã¯Server Componentsã‚’importã§ããªã„åˆ¶ç´„ãŒã‚ã‚‹ãŸã‚ã€childrenç­‰ã®propsã§Server Componentsã‚’å—ã‘æ¸¡ã™Compositionãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ´»ç”¨ã€‚
- ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ„ãƒªãƒ¼ã®æœ«ç«¯ã‚’Client Componentsã«ã™ã‚‹ã“ã¨ã§ã€Client Boundaryã‚’ä¸‹å±¤ã«é™å®šã€‚
- ä¸Šä½å±¤ã§Client ComponentsãŒå¿…è¦ãªå ´åˆã‚‚ã€Compositionãƒ‘ã‚¿ãƒ¼ãƒ³ã§Server Componentsã‚’childrenã¨ã—ã¦æ¸¡ã™è¨­è¨ˆã‚’æ¨å¥¨ã€‚
- è¨­è¨ˆåˆæœŸã‹ã‚‰Compositionãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ„è­˜ã—ã€å¾Œã‹ã‚‰ã®å¤§å¹…ãªæ‰‹æˆ»ã‚Šã‚’é˜²ãã€‚

## 4. Container 1stãªè¨­è¨ˆæ‰‹é †
- ç”»é¢è¨­è¨ˆã¯ã¾ãšContainer Componentsã®ãƒ„ãƒªãƒ¼æ§‹é€ ã‚’æ›¸ãå‡ºã—ã€Containerã®ã¿ã§è¨­è¨ˆã™ã‚‹ã€‚
- Presentational/Client Componentsã¯å¾Œã‹ã‚‰è¿½åŠ ãƒ»åˆ†å‰²ã™ã‚‹ã€‚
- Container/Presentational/Compositionãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’çµ„ã¿åˆã‚ã›ã€æ‰‹æˆ»ã‚Šã®å°‘ãªã„è¨­è¨ˆé †åºã‚’å¾¹åº•ã€‚
- ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã¯Containerå˜ä½ã§åˆ†å‰²ã—ã€Containeré…ä¸‹ã«Presentational/Client Componentsã‚’ã‚³ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€‚
- `_containers`ã‚„`_components`ç­‰ã®Private Folderã‚’æ´»ç”¨ã—ã€è²¬å‹™ã”ã¨ã«æ•´ç†ã€‚

## 5. ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§ã¨ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆå®šç¾©
- Presentational Componentsã¯Container Componentsã®å®Ÿè£…è©³ç´°ï¼ˆãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆå®šç¾©ï¼‰ã¨ã—ã¦æ‰±ã†ã€‚
- ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§ã‚’é«˜ã‚ã‚‹ãŸã‚ã€Container/Presentationalåˆ†é›¢ãƒ»propså—ã‘æ¸¡ã—ãƒ»å‰¯ä½œç”¨åˆ†é›¢ã‚’å¾¹åº•ã€‚

## 6. ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ãƒ»æ³¨æ„ç‚¹
- Client Boundaryã®å½¢æˆä½ç½®ã«æ³¨æ„ã—ã€Server Componentsã®ãƒ¡ãƒªãƒƒãƒˆã‚’æœ€å¤§åŒ–ã€‚
- Compositionãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å¾Œã‹ã‚‰é©ç”¨ã™ã‚‹å ´åˆã®æ‰‹æˆ»ã‚Šãƒªã‚¹ã‚¯ã«æ³¨æ„ã€‚
- ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ï¼ˆRTL/Storybookç­‰ï¼‰ã®Server Componentså¯¾å¿œçŠ¶æ³ã‚‚éšæ™‚ç¢ºèªã€‚

## 7. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã¨ãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ãƒ«ãƒ¼ãƒ«

### 7.1 åŸºæœ¬ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ
Containerå˜ä½ã§ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’åˆ†å‰²ã—ã€App Routerã®Private Folderã‚’æ´»ç”¨ã—ãŸæ§‹æˆã‚’æ¡ç”¨ã™ã‚‹ã€‚

```
app
â”œâ”€â”€ <Segment>
â”‚  â”œâ”€â”€ page.tsx
â”‚  â”œâ”€â”€ layout.tsx
â”‚  â”œâ”€â”€ _containers                    // Container Componentsç¾¤ï¼ˆPrivate Folderï¼‰
â”‚  â”‚  â”œâ”€â”€ <Container Name>            // ä¾‹: post-list, user-profile
â”‚  â”‚  â”‚  â”œâ”€â”€ index.tsx               // Container Componentsã‚’exportï¼ˆå…¬é–‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼‰
â”‚  â”‚  â”‚  â”œâ”€â”€ container.tsx           // Container Componentå®Ÿè£…
â”‚  â”‚  â”‚  â”œâ”€â”€ presentational.tsx     // Presentational Componentå®Ÿè£…
â”‚  â”‚  â”‚  â”œâ”€â”€ fetcher.ts               // è¤‡æ•°å›ç™ºç”Ÿã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒã‚„è¤‡é›‘ãªãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒå±¤
â”‚  â”‚  â”‚  â”œâ”€â”€ types.ts               // å‹å®šç¾©
â”‚  â”‚  â”‚  â””â”€â”€ utils.ts               // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
â”‚  â”‚  â””â”€â”€ ...
â”‚  â”œâ”€â”€ _components                   // æ±ç”¨çš„ãªShared/Client Componentsï¼ˆPrivate Folderï¼‰
â”‚  â”œâ”€â”€ _lib                         // æ±ç”¨çš„ãªé–¢æ•°ãƒ»ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼ˆPrivate Folderï¼‰
â”‚  â”‚  â””â”€â”€ utils.ts                  // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
â”‚  â””â”€â”€ _types                       // å‹å®šç¾©ï¼ˆPrivate Folderï¼‰
â””â”€â”€ ...
```

### 7.2 Containerå˜ä½ã®ãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ãƒ«ãƒ¼ãƒ«

#### `_container`å†…å¿…é ˆãƒ•ã‚¡ã‚¤ãƒ«
- `index.tsx`: Container Componentsã®å…¬é–‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã€‚å¤–éƒ¨ã‹ã‚‰ã¯ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«çµŒç”±ã§ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹
- `container.tsx`: Container Componentæœ¬ä½“ã€‚ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒã¨ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ‹…å½“
- `presentational.tsx`: Presentational Componentå®Ÿè£…ã€‚UIã®è¡¨ç¤ºè²¬å‹™ã®ã¿

#### ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«
- `fetcher.ts`: ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒå±¤ã€‚è¤‡æ•°å›ç™ºç”Ÿã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒã‚„è¤‡é›‘ãªãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒå‡¦ç†ã‚’æ ¼ç´
- `types.ts`: Containerå›ºæœ‰ã®å‹å®šç¾©
- `utils.ts`: Containerå›ºæœ‰ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
- `hooks.tsx`: Containerå›ºæœ‰ã®Custom Hooksï¼ˆClient Componentsç”¨ï¼‰

### 7.3 Private Folderã®æ´»ç”¨ãƒ«ãƒ¼ãƒ«
- `_`ã§å§‹ã¾ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯App Routerã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨æ˜ç¢ºã«åŒºåˆ¥
- `_containers`: Container Componentsç¾¤
- `_components`: Route Segmentå†…ã§å…±é€šåˆ©ç”¨ã•ã‚Œã‚‹Shared/Client Components
- `_lib`: Route Segmentå†…ã§å…±é€šåˆ©ç”¨ã•ã‚Œã‚‹é–¢æ•°ãƒ»ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
- `_types`: Route Segmentå†…ã§å…±é€šåˆ©ç”¨ã•ã‚Œã‚‹å‹å®šç¾©

### 7.4 ã‚³ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹
- Container Componentsã¯Route Segmentã«å¯†çµåˆã™ã‚‹ãŸã‚ã€å¯èƒ½ãªé™ã‚Šã‚³ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³
- Presentational Componentsã¯Container Componentsã®å®Ÿè£…è©³ç´°ã¨ã—ã¦åŒä¸€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®
- è¤‡æ•°ã®Containerã§å…±é€šåˆ©ç”¨ã•ã‚Œã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯`_components`ã«é…ç½®
- ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒé–¢æ•°ã¯å¯¾å¿œã™ã‚‹Containerãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã¾ãŸã¯Route Segmentã®`_lib`ã«é…ç½®

### 7.5 importåˆ¶é™ã¨ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆå®šç¾©
- Presentational Componentsã¯Container Componentsã®å®Ÿè£…è©³ç´°ã¨ã—ã¦æ‰±ã†
- å¤–éƒ¨ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ã¯`index.tsx`çµŒç”±ã®ã¿ã‚’åŸå‰‡ã¨ã™ã‚‹
- [eslint-plugin-import-access](mdc:https:/github.com/uhyo/eslint-plugin-import-access)ã®å°å…¥ã‚’æ¨å¥¨ã—ã€äºˆæœŸã›ã¬å¤–éƒ¨importã‚’åˆ¶é™
- Containeré…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯å®Ÿè³ªçš„ãªãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆå®šç¾©ã¨ã—ã¦è¨­è¨ˆ

### 7.6 è¨­è¨ˆä¾‹
```tsx
// app/posts/[postId]/_containers/post-detail/index.tsx
export { PostDetailContainer } from './container';

// app/posts/[postId]/_containers/post-detail/container.tsx
import { PostDetailPresentation } from './presentational';
import { UserProfileContainer } from '../user-profile';

export async function PostDetailContainer({ postId }: { postId: string }) {
  const post = await getPost(postId);
  
  return (
    <PostDetailPresentation post={post}>
      <UserProfileContainer userId={post.userId} />
    </PostDetailPresentation>
  );
}

// app/posts/[postId]/_containers/post-detail/presentational.tsx
import { ReactNode } from 'react';

interface Props {
  post: Post;
  children: ReactNode;
}

export function PostDetailPresentation({ post, children }: Props) {
  return (
    <article>
      <h1>{post.title}</h1>
      <div>{post.content}</div>
      <aside>{children}</aside>
    </article>
  );
}
```

---

## å‚è€ƒmdãƒ•ã‚¡ã‚¤ãƒ«
- [part_2_container_presentational_pattern.md](mdc:docs/akfm-knowledge/nextjs-basic-principle/part_2_container_presentational_pattern.md)
- [part_2_container_1st_design.md](mdc:docs/akfm-knowledge/nextjs-basic-principle/part_2_container_1st_design.md)
- [part_2_composition_pattern.md](mdc:docs/akfm-knowledge/nextjs-basic-principle/part_2_composition_pattern.md)
- [part_2_client_components_usecase.md](mdc:docs/akfm-knowledge/nextjs-basic-principle/part_2_client_components_usecase.md)


</rewritten_file>
